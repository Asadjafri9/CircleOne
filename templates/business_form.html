{% extends "base.html" %}

{% block title %}{{ 'Edit' if mode == 'edit' else 'Create' }} Business Listing{% endblock %}

{% block content %}
<div class="business-form-page">
    <div class="form-header">
        <h1>{{ 'Edit' if mode == 'edit' else 'Create New' }} Business Listing</h1>
        <p class="subtitle">{{ 'Update your business information' if mode == 'edit' else 'Add your business to the directory' }}</p>
    </div>

    <form method="POST" enctype="multipart/form-data" class="business-form">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
        <div class="form-section">
            <h2>Basic Information</h2>
            
            <div class="form-group">
                <label for="business_name">Business Name *</label>
                <input type="text" 
                       id="business_name" 
                       name="business_name" 
                       value="{{ business.business_name if business else '' }}"
                       required 
                       class="form-control">
            </div>

            <div class="form-group">
                <label for="category">Category *</label>
                <select id="category" name="category" required class="form-control">
                    <option value="">Select a category</option>
                    <option value="Restaurant" {% if business and business.category == 'Restaurant' %}selected{% endif %}>Restaurant</option>
                    <option value="Retail" {% if business and business.category == 'Retail' %}selected{% endif %}>Retail</option>
                    <option value="Service" {% if business and business.category == 'Service' %}selected{% endif %}>Service</option>
                    <option value="Technology" {% if business and business.category == 'Technology' %}selected{% endif %}>Technology</option>
                    <option value="Healthcare" {% if business and business.category == 'Healthcare' %}selected{% endif %}>Healthcare</option>
                    <option value="Education" {% if business and business.category == 'Education' %}selected{% endif %}>Education</option>
                    <option value="Entertainment" {% if business and business.category == 'Entertainment' %}selected{% endif %}>Entertainment</option>
                    <option value="Real Estate" {% if business and business.category == 'Real Estate' %}selected{% endif %}>Real Estate</option>
                    <option value="Professional Services" {% if business and business.category == 'Professional Services' %}selected{% endif %}>Professional Services</option>
                    <option value="Other" {% if business and business.category == 'Other' %}selected{% endif %}>Other</option>
                </select>
            </div>

            <div class="form-group">
                <label for="description">Description</label>
                <textarea id="description" 
                          name="description" 
                          rows="5" 
                          class="form-control"
                          placeholder="Tell customers about your business...">{{ business.description if business else '' }}</textarea>
            </div>

            <div class="form-group">
                <label for="location">Location</label>
                <input type="text" 
                       id="location" 
                       name="location" 
                       value="{{ business.location if business else '' }}"
                       placeholder="City, State or Full Address"
                       class="form-control">
            </div>

            <div class="form-group">
                <label for="logo_file">Business Logo (Upload Image)</label>
                <div class="file-upload-section">
                    <input type="file" 
                           id="logo_file" 
                           name="logo_file" 
                           accept="image/png,image/jpeg,image/jpg,image/gif,image/webp"
                           class="form-control file-input"
                           onchange="previewImage(event)">
                    <small class="form-text">Accepted formats: PNG, JPG, GIF, WEBP. Max size: 5MB</small>
                    
                    {% if business and business.logo_url %}
                    <div class="current-logo">
                        <p><strong>Current Logo:</strong></p>
                        <img src="{{ business.logo_url }}" alt="Current logo" class="logo-preview-small">
                    </div>
                    {% endif %}
                    
                    <div id="imagePreview" class="image-preview" style="display: none;">
                        <p><strong>New Logo Preview:</strong></p>
                        <img id="preview" src="#" alt="Preview" class="logo-preview-small">
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label for="logo_url">Or Enter Logo URL</label>
                <input type="url" 
                       id="logo_url" 
                       name="logo_url" 
                       value="{{ business.logo_url if business and not request.files.get('logo_file') else '' }}"
                       placeholder="https://example.com/logo.png"
                       class="form-control">
                <small class="form-text">Alternatively, you can provide a logo URL instead of uploading</small>
            </div>
        </div>

        <div class="form-section">
            <h2>Contact Details</h2>
            
            <div class="form-group">
                <label for="contact_email">Email</label>
                <input type="email" 
                       id="contact_email" 
                       name="contact_email" 
                       value="{{ business.contact_email if business else '' }}"
                       placeholder="contact@business.com"
                       class="form-control">
            </div>

            <div class="form-group">
                <label for="phone">Phone</label>
                <input type="tel" 
                       id="phone" 
                       name="phone" 
                       value="{{ business.phone if business else '' }}"
                       placeholder="+1 (555) 123-4567"
                       class="form-control">
            </div>

            <div class="form-group">
                <label for="website">Website</label>
                <input type="url" 
                       id="website" 
                       name="website" 
                       value="{{ business.website if business else '' }}"
                       placeholder="https://www.business.com"
                       class="form-control">
            </div>

            <div class="form-group">
                <label for="hours">Business Hours</label>
                <textarea id="hours" 
                          name="hours" 
                          rows="3" 
                          class="form-control"
                          placeholder="Mon-Fri: 9am-5pm&#10;Sat: 10am-2pm&#10;Sun: Closed">{{ business.hours if business else '' }}</textarea>
            </div>
        </div>

        <div class="form-section">
            <h2>Social Media (Optional)</h2>
            {% set social = business.get_social_links() if business else {} %}
            
            <div class="form-group">
                <label for="facebook">Facebook</label>
                <input type="url" 
                       id="facebook" 
                       name="facebook" 
                       value="{{ social.facebook if social.facebook else '' }}"
                       placeholder="https://facebook.com/yourbusiness"
                       class="form-control">
            </div>

            <div class="form-group">
                <label for="twitter">Twitter</label>
                <input type="url" 
                       id="twitter" 
                       name="twitter" 
                       value="{{ social.twitter if social.twitter else '' }}"
                       placeholder="https://twitter.com/yourbusiness"
                       class="form-control">
            </div>

            <div class="form-group">
                <label for="instagram">Instagram</label>
                <input type="url" 
                       id="instagram" 
                       name="instagram" 
                       value="{{ social.instagram if social.instagram else '' }}"
                       placeholder="https://instagram.com/yourbusiness"
                       class="form-control">
            </div>

            <div class="form-group">
                <label for="linkedin">LinkedIn</label>
                <input type="url" 
                       id="linkedin" 
                       name="linkedin" 
                       value="{{ social.linkedin if social.linkedin else '' }}"
                       placeholder="https://linkedin.com/company/yourbusiness"
                       class="form-control">
            </div>
        </div>

        <div class="form-actions">
            <button type="submit" class="btn btn-primary btn-large">
                {{ 'Update Business' if mode == 'edit' else 'Create Business' }}
            </button>
            <a href="{{ url_for('business_detail', id=business.id) if business else url_for('businesses') }}" 
               class="btn btn-secondary">Cancel</a>
        </div>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
function previewImage(event) {
    const file = event.target.files[0];
    const preview = document.getElementById('preview');
    const previewContainer = document.getElementById('imagePreview');
    
    if (file) {
        // Validate file size (5MB)
        const maxSize = 5 * 1024 * 1024;
        if (file.size > maxSize) {
            alert('File is too large. Maximum size is 5MB.');
            event.target.value = '';
            previewContainer.style.display = 'none';
            return;
        }
        
        // Validate file type
        const allowedTypes = ['image/png', 'image/jpeg', 'image/jpg', 'image/gif', 'image/webp'];
        if (!allowedTypes.includes(file.type)) {
            alert('Invalid file type. Please upload PNG, JPG, GIF, or WEBP.');
            event.target.value = '';
            previewContainer.style.display = 'none';
            return;
        }
        
        // Show preview
        const reader = new FileReader();
        reader.onload = function(e) {
            preview.src = e.target.result;
            previewContainer.style.display = 'block';
        }
        reader.readAsDataURL(file);
    } else {
        previewContainer.style.display = 'none';
    }
}
</script>
{% endblock %}
